# Computer-System 笔记
## 第一章 计算机系统漫游
*计算机系统*使由硬件和系统软件组成的，它们共同工作来运行应用程序。
```C
  #include <stdio.h>
  
  int main(){
    printf("hello, world\n");
    return 0;
  }
```
hello程序的生命周期使从一个*源程序*（或者说源文件）开始的，即程序员通过编辑器闯创建并保存的文本文件，文件名是hello.c。源程序实际上就是一个由值0和1组成的位（又称为比特）序列，8和位被组织成一组，称为字节。每个字节表示程序中的某些文本字符。
</br>
像hello.c这样中只由ASCII字符构成的文件称为*文本文件*，所有其他文件都称为*二进制文件*。系统中所有的信息——包括磁盘文件、内存中的程序、内存中存放到用户数据以及网络上传送到数据，都是有一串比特表示对。在不同的上下文中，一个同样的字节序列可能表示一个整数、浮点数、字符串或者机器指令。
</br>

每条C语句都必须被其他程序转化为一系列的低级*机械语言*指令。这四个阶段（预处理器，编辑器，汇编器和链接器）一起构成了*编译系统*（compilation system）
<img src="/1132383-20180927113620240-151805730.png" width="70%" height="60%">
* 预处理阶段：根据以字符#开头的命令，修改原始的C程序
* 编译阶段：将文本文件hello.i 翻译成文本文件hello.s，它包含一个*汇编语言程序*。
* 汇编阶段：汇编器将hello.s翻译成机器语言指令，把这些指令打包成一种叫做*可重定位目标程序*（relocatable object program）的格式，并将结果保存在目标文件hello.o中
* 链接阶段：hello程序调用了printf函数，他是每个C编译器都提供的标准C库中的一个函数。printf存在于一个名为printf.o的单独的预编译好了的目标文件中，而这个文件必须以某种方式合并到我们的hello.o程序中。结果就得到hello文件，他是一个*可执行目标文件*（或者简称为可执行文件）。

**系统的硬件组成**  
<img src="/1092156-20190826203634215-139650438.png" width="70%" height="60%" >
* 总线： 贯穿整个系统的一组电子管道，他携带信息字节并负责在各个部件间传递。通常总线被设计成传送定长的字节快，也就是字（word）。字中的字节数（即字长）是一个基本的系统参数，各个系统中都不尽相同。
* I/O设备：使系统与外部世界的联系通道。最开始，可执行程序hello就存放在磁盘上。每个I/O设备都通过一个*控制器*或*适配器*与I/O总线相连。控制器和适配器之间的区别主要在于它们的封装方式，控制器使I/O设备本是或者系统的主印制电路板（通常称为主板）上的芯片组。而适配器则是一块插在主板上插槽的卡。无论如何，它们的功能都是在I/O设备之间传递信息。
* 主存：是一个临时储存设备，在处理器执行程序时，用来存放程序和程序处理的诗句。从物理上来说，主存使由一组*动态随机存取储存器*（DRAM）芯片组成的。从逻辑上来说，存储器是一个线性的字节数组，每个字节都有其唯一的地址（数组索引），这些地址是从令零开始的，一般来说，组成程序的每条机器指令都由不同适量的字节构成。
* 处理器：*中央处理单元*（CPU），简称处理器，是解释（或执行）存储在主存中指令的引擎。处理器的核心是一个大小为一个字的储存设备（或寄存器），称为*程序计数器*（PC）。在任何时刻，PC都指向主存中的某条机器语言指令（即含有该条指令的地址）。
从系统通电开始，知道系统断电，处理器一直在不断的执行程序计数器指向的指令，再更新程序计数器，使其指向下一条指令。处理器*看上去*是按照一个非常简单的指令执行模型来操作的。这个模型是由*指令集架*决定的。在这个模型中，指令按照严格的顺序执行，而执行一条指令包含一系列的步骤。处理器从程序计数器指向的内存处读取指令，解释指令中的位，执行该指令指示的简单操作，然后更新PC，使其指向下一条指令，而这条指令并不一定和在内存中刚刚执行的指令相邻。  
这样的简单操作并不多，他们围绕着主存、*寄存器文件*（reguster file）和算术/*逻辑单元*（ALU）进行。寄存文件是一个小的储存设备，由一些单个字长的寄存器组成，每个寄存器都有唯一的名字。ALU计算新的数据和地址值。下面这些是一些简单操作的例子，CPU在指令的要求下可能会执行这些操作。
  - 加载：从主存复制一个字节或者一个字到寄存器，以覆盖寄存器原来的内容。
  - 存储：从寄存器赋值一个字节或者一个字到主存的某个位置，以覆盖这个位置上原来得到内容。
  - 操作：把两个寄存器的内容复制到ALU，ALU对这两个字做算术运算，并将结果存放到一个寄存器中，以覆盖该寄存器中原来的内容。
  - 跳转：从指令本身中抽取一个字，并将这个字复制到程序计数器（PC）中，以覆盖PC中原来的值。\

处理器看上去是它的指令集架构的简单实现，但是实际上现代处理器使用了非常复杂的机制来加速程序的执行。因此，我们将处理器的指令集架构和处理器的*微体系结构*区分开来：指令集架构描述的是每条机器代码指令的效果；而微体系架构描述的是处理器实际上是如何实现的。\


**运行hello程序**  
初始时，shell程序执行它的指令，等待我们输入一个指令。当我们在键盘上输入字符串“./hello”后，shell程序将字符逐一读入寄存器，再把它存放到内存中。  
<img src="/0.jfif" width="60%" height="40%">  
当我们在键盘上敲回车时，shell程序就知道我们已经结束了命令的输入。然后shell执行一系列指令来加载可执的hello文件，这些指令将hello目标文件中的代码和数据从磁盘复制到主存。数据包括最终会输出的字符串“hello，world\n”。  
<img src="/1.jfif" width="60%" height="40%">  
一旦目标文件hello中的代码和数据被加载到主存，处理器就开始执行hello程序的main程序中的机器语言指令。这些指令将“hello，world\n”字符串中的字节从贮存复制到寄存器文件中，再从寄存器文件中复制到显示设备，最终显示在屏幕上。  
<img src="/2.jfif" width="60%" height="40%">




